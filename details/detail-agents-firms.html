<div id="detail-agents-firms">
    <div class="detail-content">
        <div class="detail-header">
            <h2 class="detail-title">🏭 Firms</h2>
            <button class="detail-close" onclick="hideDetail()">Close</button>
        </div>
        <div class="detail-section">
            <h3>Manufacturing Firms' Operation Flow</h3>
            <p><em>Hover over elements for details</em></p>
            <div class="interactive-flowchart">
                <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 12px; padding: 20px; margin: 20px 0; overflow-x: auto; max-height: 70vh; overflow-y: auto;">
                    <div style="display: flex; flex-direction: column; gap: 20px; min-width: 1200px;">
                        
                        <!-- Firm Departments -->
                        <div style="background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px;">
                            <div style="font-size: 18px; font-weight: bold; margin-bottom: 15px; color: #2c3e50;">🏢 Firm Departments</div>
                            <div style="display: flex; justify-content: flex-start; align-items: center; gap: 20px; margin: 10px 0;">
                                <div style="background: #e8f5e8; border: 2px solid #28a745; border-radius: 8px; padding: 10px 15px; font-weight: bold; text-align: center; min-width: 100px; font-size: 12px; color: #1a365d; position: relative; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Production Department', 'Manages manufacturing processes, production planning, quality control, and operational efficiency. Handles input procurement, production scheduling, and output delivery.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">🏭 Production Dept.</div>
                                <div style="background: #f0e6ff; border: 2px solid #6f42c1; border-radius: 8px; padding: 10px 15px; font-weight: bold; text-align: center; min-width: 100px; font-size: 12px; color: #1a365d; position: relative; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Finance Department', 'Handles financial planning, credit applications, debt management, interest payments, and accounting. Manages cash flow, financial status monitoring, and investment decisions.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">💰 Finance Dept.</div>
                                <div style="background: #e6f3ff; border: 2px solid #0099ff; border-radius: 8px; padding: 10px 15px; font-weight: bold; text-align: center; min-width: 100px; font-size: 12px; color: #1a365d; position: relative; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Marketing Department', 'Manages pricing strategies, market analysis, customer relations, and sales activities. Handles product positioning, market research, and competitive analysis.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">📊 Marketing Dept.</div>
                                <div style="background: #ffeaea; border: 2px solid #dc3545; border-radius: 8px; padding: 10px 15px; font-weight: bold; text-align: center; min-width: 100px; font-size: 12px; color: #1a365d; position: relative; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'R&D Department', 'Conducts research and development activities, process innovation, product innovation, and technology advancement. Manages intellectual property and innovation strategies.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">🔬 R&D Dept.</div>
                                <div style="background: #fff4e6; border: 2px solid #fd7e14; border-radius: 8px; padding: 10px 15px; font-weight: bold; text-align: center; min-width: 100px; font-size: 12px; color: #1a365d; position: relative; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'HR Department', 'Manages human resources, labor market activities, employee training, skills development, and wage payments. Handles recruitment, performance management, and workforce planning.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">👥 HR Dept.</div>
                            </div>
                        </div>
                        
                        <!-- Planning Phase -->
                        <div style="background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #28a745;">
                            <div style="font-size: 18px; font-weight: bold; margin-bottom: 15px; color: #2c3e50;">📋 Planning Phase (Priority: 95-75)</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                                <div style="background: #e6f3ff; border: 2px solid #0099ff; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Pricing Strategy', 'Sets product prices based on market conditions, cost structure, and competitive positioning. Considers demand elasticity, production costs, and profit margins.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Pricing</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(95)</div>
                                </div>
                                <div style="background: #e8f5e8; border: 2px solid #28a745; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Compute Planned Output', 'Calculates planned production levels based on demand expectations, inventory buffers, and capacity constraints. Uses Cobb-Douglas production function with labor, capital, and energy inputs to determine optimal output quantities.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Compute Planned Output</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(90)</div>
                                </div>
                                <div style="background: #e8f5e8; border: 2px solid #28a745; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Choose Suppliers (1st Round)', 'First round of selecting input suppliers based on price, quality, and delivery terms. Evaluates supplier offers for raw materials, intermediate goods, and services needed for production planning.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Choose Suppliers</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(80)</div>
                                </div>
                                <div style="background: #ffeaea; border: 2px solid #dc3545; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'R&D Planning', 'Plans research and development activities including process innovation, product innovation, and technology advancement. Allocates R&D budget and sets innovation priorities for improving efficiency and competitiveness.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">R&D Planning</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(80)</div>
                                </div>
                                <div style="background: #e8f5e8; border: 2px solid #28a745; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Allocate Planned Output', 'Distributes planned output among the firm\'s plants based on capacity, efficiency, and resource availability. Optimizes production allocation across multiple production facilities to maximize overall output.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Allocate Planned Output</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(76)</div>
                                </div>
                                <div style="background: #e8f5e8; border: 2px solid #28a745; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Compute Input Demand', 'Determines necessary inputs for production including raw materials, intermediate goods, labor, and energy. Calculates input requirements based on planned output and production technology coefficients.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Compute Input Demand</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(75)</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Financial Operations Phase -->
                        <div style="background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #6f42c1;">
                            <div style="font-size: 18px; font-weight: bold; margin-bottom: 15px; color: #2c3e50;">💰 Financial Operations Phase (Priority: 70-64)</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                                <div style="background: #f0e6ff; border: 2px solid #6f42c1; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Financial Planning', 'Develops comprehensive financial strategy including budget allocation, investment planning, and risk management. Analyzes cash flow projections and determines funding requirements.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Financial Planning</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(70)</div>
                                </div>
                                <div style="background: #f0e6ff; border: 2px solid #6f42c1; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Credit Application', 'Applies for credit from banks when internal financial resources are insufficient. Evaluates credit needs based on production requirements, investment plans, and cash flow projections.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Credit Application</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(69)</div>
                                </div>
                                <div style="background: #f0e6ff; border: 2px solid #6f42c1; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Choose Credit Offers', 'Selects from available credit offers based on interest rates, terms, and conditions. Compares multiple bank offers to choose the most favorable financing option for the firm\'s needs.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Choose Credit Offers</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(67)</div>
                                </div>
                                <div style="background: #f0e6ff; border: 2px solid #6f42c1; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Financial Status Assessment', 'Assesses the current financial health of the firm including liquidity, solvency, and profitability. Evaluates cash flow, debt levels, and financial constraints to inform future decisions.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Financial Status</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(66)</div>
                                </div>
                                <div style="background: #f0e6ff; border: 2px solid #6f42c1; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Interest & Installment Payments', 'Makes scheduled payments on outstanding debt including interest and principal installments. Manages debt service obligations and maintains credit relationships with lenders.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Interest Payments</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(65)</div>
                                </div>
                                <div style="background: #f0e6ff; border: 2px solid #6f42c1; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Debt Restructuring', 'Handles debt restructuring when financial distress occurs. Negotiates with creditors to modify payment terms, extend maturities, or reduce debt burden to improve financial stability.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Debt Restructuring</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(65)</div>
                                </div>
                                <div style="background: #e8f5e8; border: 2px solid #28a745; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Replanning Production', 'Adjusts production plans based on updated financial constraints, market conditions, or resource availability. Modifies output targets when financial resources are limited or market conditions change.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Replanning Production</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(64)</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Labor & Resource Allocation Phase -->
                        <div style="background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #fd7e14;">
                            <div style="font-size: 18px; font-weight: bold; margin-bottom: 15px; color: #2c3e50;">👥 Labor & Resource Allocation Phase (Priority: 60-56)</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                                <div style="background: #fff4e6; border: 2px solid #fd7e14; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Labor Market Activities (1st Round)', 'Manages hiring and firing decisions in the first round of labor market interactions. Posts job vacancies, evaluates candidates, and matches workers to positions based on wage offers and skill requirements.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Labor Market Activities</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(60)</div>
                                </div>
                                <div style="background: #e8f5e8; border: 2px solid #28a745; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Re-allocate Planned Output', 'Re-distributes planned output among plants after labor market activities. Adjusts production allocation based on updated labor availability and capacity constraints.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">ReAllocate Planned Output</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(59)</div>
                                </div>
                                <div style="background: #fff4e6; border: 2px solid #fd7e14; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Labor Market Activities (2nd Round)', 'Second phase of labor market interactions for remaining vacancies. Completes hiring process for unfilled positions and adjusts workforce based on production needs.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Labor Market Activities 2nd</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(56)</div>
                                </div>
                                <div style="background: #e8f5e8; border: 2px solid #28a745; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Input Order (1st Round)', 'Places orders for inputs in the first round based on computed input demand. Orders raw materials, intermediate goods, and services from selected suppliers for production.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Input Order</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(56)</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Supply Chain Phase -->
                        <div style="background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #17a2b8;">
                            <div style="font-size: 18px; font-weight: bold; margin-bottom: 15px; color: #2c3e50;">🚚 Supply Chain Phase (Priority: 50-46)</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                                <div style="background: #e8f5e8; border: 2px solid #28a745; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Input Delivery (1st Round)', 'Processes received input deliveries from the first round of orders. Updates inventory levels and prepares inputs for production processes.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Input Delivery</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(50)</div>
                                </div>
                                <div style="background: #e8f5e8; border: 2px solid #28a745; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Choose Suppliers (2nd Round)', 'Second round of selecting input suppliers for additional or alternative inputs. Evaluates new supplier offers and fills remaining input requirements.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Choose Supplier 2nd</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(49)</div>
                                </div>
                                <div style="background: #e8f5e8; border: 2px solid #28a745; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Input Order (2nd Round)', 'Places additional orders for inputs in the second round. Orders remaining inputs from second-round suppliers to complete production requirements.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Input Order 2nd</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(48)</div>
                                </div>
                                <div style="background: #e8f5e8; border: 2px solid #28a745; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Input Delivery (2nd Round)', 'Processes received input deliveries from the second round of orders. Completes input inventory and prepares all necessary inputs for production.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Input Delivery 2nd</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(46)</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Production & Delivery Phase -->
                        <div style="background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #28a745;">
                            <div style="font-size: 18px; font-weight: bold; margin-bottom: 15px; color: #2c3e50;">🏭 Production & Delivery Phase (Priority: 42-35)</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                                <div style="background: #e8f5e8; border: 2px solid #28a745; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Production Process', 'Executes manufacturing processes using available inputs, labor, and capital. Converts raw materials into finished products following production schedules and quality standards.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Production</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(42)</div>
                                </div>
                                <div style="background: #fff4e6; border: 2px solid #fd7e14; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Pay Wages', 'Pays wages to employees based on work contracts and labor agreements. Calculates total wage costs and updates employee compensation according to employment terms.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Pay Wages</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(41)</div>
                                </div>
                                <div style="background: #e8f5e8; border: 2px solid #28a745; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Capital Stock Adjustment', 'Adjusts the firm\'s capital stock through capacity expansion, equipment upgrades, or new plant construction. Implements investment decisions to increase production capacity.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Capital Stock Adjustment</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(40)</div>
                                </div>
                                <div style="background: #e8f5e8; border: 2px solid #28a745; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Manage Energy Costs', 'Manages energy procurement, sourcing, and cost optimization. Handles energy contracts, efficiency investments, and responds to energy price changes through fuel switching or efficiency upgrades.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Manage Energy Costs</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(40)</div>
                                </div>
                                <div style="background: #e8f5e8; border: 2px solid #28a745; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Output Delivery', 'Delivers finished goods to the market/mall for sale. Manages product distribution and ensures goods reach customers through the goods market system.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Output Delivery</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(35)</div>
                                </div>
                                <div style="background: #e8f5e8; border: 2px solid #28a745; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Market Delivery', 'Completes the market delivery process and handles final sales transactions. Manages customer orders, payment processing, and inventory updates after sales.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Market Delivery</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(35)</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Innovation & Accounting Phase -->
                        <div style="background: white; border-radius: 8px; padding: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid #dc3545;">
                            <div style="font-size: 18px; font-weight: bold; margin-bottom: 15px; color: #2c3e50;">💡 Innovation & Accounting Phase (Priority: 30-25)</div>
                            <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                                <div style="background: #ffeaea; border: 2px solid #dc3545; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Process Innovation', 'Implements process innovations from R&D activities to improve production efficiency, reduce costs, and enhance productivity. Applies new technologies and methods to existing production processes.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Process Innovation</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(30)</div>
                                </div>
                                <div style="background: #ffeaea; border: 2px solid #dc3545; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Product Innovation', 'Implements product innovations from R&D to develop new products, improve existing products, or enhance product quality. Introduces new features and capabilities to maintain competitiveness.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Product Innovation</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(30)</div>
                                </div>
                                <div style="background: #fff4e6; border: 2px solid #fd7e14; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Skills Update', 'Updates employee skills through training, education, and experience. Enhances workforce capabilities to improve productivity and adapt to technological changes.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Skills Update</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(29)</div>
                                </div>
                                <div style="background: #e8f5e8; border: 2px solid #28a745; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Productivity Adjustment', 'Adjusts firm productivity based on various factors including innovation, skill improvements, technology adoption, and efficiency gains. Updates total factor productivity parameters.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Productivity Adjustment</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(28)</div>
                                </div>
                                <div style="background: #f0e6ff; border: 2px solid #6f42c1; border-radius: 6px; padding: 8px 12px; cursor: pointer; transition: all 0.3s ease; font-size: 14px; position: relative; min-width: 120px; text-align: center;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'; showTooltip(event, 'Accounting', 'Finalizes financial accounts, reconciles inventory, and prepares financial statements. Records all transactions, calculates profits/losses, and updates balance sheets for the current period.')" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; hideTooltip()">
                                    <div style="color: #1a365d; font-weight: bold;">Accounting</div>
                                    <div style="font-size: 12px; color: #666; font-weight: bold;">(25)</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Flow Continuation Note -->
                        <div style="text-align: center; margin: 20px 0; color: #666; font-style: italic; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <strong>Complete Operations Cycle:</strong> The flowchart shows the full firm decision-making process with feedback loops connecting Accounting back to the next iteration cycle.
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="detail-section">
            <h3>Scale & Distribution</h3>
            <ul class="detail-list">
                <li>Scale Ratio：3,500+ heterogeneous firms with 1:1000 </li>
                <li>Economic sector: 20 sectors across 72 divisions (German WZ 2008 classification) </li>
                <li>Regional distribution： across 16 German states</li>
                <li>Size distribution: micro (250+), small (10-49), medium (50-249), large (1-9)</li>
            </ul>
        </div>
    </div>
</div>

<style>
    .tooltip {
        position: absolute;
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 12px 16px;
        border-radius: 8px;
        font-size: 13px;
        max-width: 300px;
        z-index: 1000;
        pointer-events: none;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .tooltip.show {
        opacity: 1;
    }
    
    .tooltip-title {
        font-weight: bold;
        margin-bottom: 6px;
        color: #ffd700;
    }
    
    .tooltip-content {
        line-height: 1.4;
    }
</style>

<script>
    function showTooltip(event, title, content) {
        // Remove existing tooltip
        hideTooltip();
        
        // Create tooltip element
        const tooltip = document.createElement('div');
        tooltip.className = 'tooltip';
        tooltip.innerHTML = `
            <div class="tooltip-title">${title}</div>
            <div class="tooltip-content">${content}</div>
        `;
        
        // Add to body
        document.body.appendChild(tooltip);
        
        // Position tooltip
        const rect = event.target.getBoundingClientRect();
        const tooltipRect = tooltip.getBoundingClientRect();
        
        let left = rect.left + (rect.width / 2) - (tooltipRect.width / 2);
        let top = rect.top - tooltipRect.height - 10;
        
        // Adjust if tooltip goes off screen
        if (left < 10) left = 10;
        if (left + tooltipRect.width > window.innerWidth - 10) {
            left = window.innerWidth - tooltipRect.width - 10;
        }
        if (top < 10) {
            top = rect.bottom + 10;
        }
        
        tooltip.style.left = left + 'px';
        tooltip.style.top = top + 'px';
        
        // Show tooltip
        setTimeout(() => tooltip.classList.add('show'), 10);
    }
    
    function hideTooltip() {
        const existingTooltip = document.querySelector('.tooltip');
        if (existingTooltip) {
            existingTooltip.remove();
        }
    }
</script>



